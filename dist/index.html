<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <title>Countercraft</title>
    <style>
      :root {
        --bg: #0d0f14;
        --panel: #131722;
        --panel-2: #171c29;
        --text: #e9ecf1;
        --muted: #9aa3b2;
        --brand: #6e9bff;
        --brand-2: #7ef0ff;
        --ring: rgba(110, 155, 255, 0.35);
        --success: #3ddc97;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        --rounded: 18px;
      }

      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        color: var(--text);
        background: radial-gradient(
            1000px 600px at 100% -10%,
            rgba(126, 240, 255, 0.08),
            transparent 60%
          ),
          radial-gradient(
            900px 500px at -10% 110%,
            rgba(110, 155, 255, 0.08),
            transparent 60%
          ),
          linear-gradient(180deg, #0b0d12, #0d0f14);
        font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto,
          Inter, "Helvetica Neue", Arial, "Noto Sans";
      }

      /* ====== Layout ====== */
      .shell {
        display: grid;
        grid-template-rows: auto 1fr;
        grid-template-columns: 280px 1fr 340px;
        grid-template-areas:
          "header header header"
          "left   main   right";
        gap: 14px;
        height: 100%;
        padding: 14px;
      }

      header {
        grid-area: header;
        background: linear-gradient(180deg, var(--panel), var(--panel-2));
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: var(--rounded);
        box-shadow: var(--shadow);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 18px;
      }

      .brand {
        display: flex;
        gap: 12px;
        align-items: center;
      }
      .brand-badge {
        width: 38px;
        height: 38px;
        border-radius: 12px;
        background: conic-gradient(from 210deg, var(--brand), var(--brand-2));
        box-shadow: 0 0 0 6px rgba(110, 155, 255, 0.08),
          0 8px 20px rgba(0, 0, 0, 0.35);
      }
      .brand-title {
        font-weight: 700;
        letter-spacing: 0.3px;
        font-size: 1.15rem;
      }
      .muted {
        color: var(--muted);
      }

      .hdr-actions {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .btn {
        appearance: none;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: linear-gradient(180deg, #1a1f2b, #141927);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 12px;
        cursor: pointer;
        transition: transform 0.08s ease, box-shadow 0.2s ease,
          border-color 0.2s ease;
      }
      .btn:hover {
        border-color: rgba(255, 255, 255, 0.18);
        box-shadow: 0 0 0 4px var(--ring);
      }
      .btn:active {
        transform: translateY(1px);
      }
      .btn-primary {
        background: linear-gradient(180deg, #213157, #1a2747);
        border-color: rgba(110, 155, 255, 0.35);
      }

      /* Panels */
      .panel {
        background: linear-gradient(180deg, var(--panel), var(--panel-2));
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: var(--rounded);
        box-shadow: var(--shadow);
        padding: 14px;
      }
      .panel-title {
        font-size: 0.95rem;
        font-weight: 700;
        letter-spacing: 0.3px;
        margin-bottom: 10px;
        color: var(--muted);
      }

      /* Left Sidebar */
      .left {
        grid-area: left;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .player-card {
        display: grid;
        grid-template-columns: 48px 1fr auto;
        gap: 10px;
        align-items: center;
        padding: 12px;
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.06);
      }
      .avatar {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        background: linear-gradient(180deg, #263147, #1d2538);
        display: grid;
        place-items: center;
        font-weight: 700;
        color: var(--brand-2);
        border: 1px solid rgba(255, 255, 255, 0.06);
      }
      .p-name {
        font-weight: 700;
      }
      .p-sub {
        font-size: 0.82rem;
        color: var(--muted);
      }
      .pill {
        font-size: 0.78rem;
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(110, 155, 255, 0.12);
        border: 1px solid rgba(110, 155, 255, 0.25);
      }

      .status-tile {
        display: grid;
        gap: 10px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 14px;
        padding: 12px;
      }
      #interval-display,
      #current-player-display {
        background: rgba(17, 22, 34, 0.75);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 10px;
        padding: 10px 12px;
        width: 100%;
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.18);
      }

      /* Main (Canvas) */
      .main {
        grid-area: main;
        position: relative;
        display: grid;
        grid-template-rows: 1fr;
      }
      .surface {
        position: relative;
        overflow: auto;
        border-radius: var(--rounded);
        border: 1px solid rgba(255, 255, 255, 0.06);
        background: radial-gradient(
            800px 300px at 20% -10%,
            rgba(110, 155, 255, 0.06),
            transparent 60%
          ),
          linear-gradient(180deg, #0f1420, #0f141c);
        box-shadow: var(--shadow);
        padding: 14px;
      }
      #canvas {
        display: block;
        margin: 0 auto;
        background: #ffffff; /* REQUIRED: white playfield */
        /* keep explicit size; container scrolls if needed */
      }

      /* Right Sidebar (Chat) */
      .right {
        grid-area: right;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .chat {
        display: grid;
        grid-template-rows: auto 1fr auto;
        gap: 10px;
        height: 100%;
      }
      .chat-log {
        overflow: auto;
        padding-right: 6px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .msg {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 12px;
        padding: 8px 10px;
        line-height: 1.35;
      }
      .msg.me {
        border-color: rgba(110, 155, 255, 0.25);
        background: rgba(110, 155, 255, 0.08);
      }

      .chat-input {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 8px;
      }
      .input {
        background: #0e1320;
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 10px 12px;
        outline: none;
      }
      .input:focus {
        border-color: rgba(110, 155, 255, 0.4);
        box-shadow: 0 0 0 4px var(--ring);
      }

      /* Responsive */
      @media (max-width: 1100px) {
        .shell {
          grid-template-columns: 1fr;
          grid-template-areas:
            "header"
            "main"
            "left"
            "right";
          height: auto;
          min-height: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <header>
        <div class="brand">
          <div class="brand-badge" aria-hidden="true"></div>
          <div>
            <div class="brand-title">Countercraft</div>
            <div class="muted" style="font-size: 0.85rem">
              First-species counterpoint
            </div>
          </div>
        </div>
        <div class="hdr-actions">
          <button class="btn" id="btnFullscreen" title="Toggle Fullscreen">
            ⛶ Fullscreen
          </button>
          <button class="btn btn-primary" id="btnLeave" title="Leave Room">
            Leave Room
          </button>
        </div>
      </header>

      <!-- LEFT: players + status -->
      <aside class="left">
        <div class="panel">
          <div class="panel-title">Players</div>

          <!-- Player 1 -->
          <div class="player-card" id="player1-card">
            <div class="avatar" id="p1-avatar">P1</div>
            <div>
              <div class="p-name" id="p1-name">Player One</div>
              <div class="p-sub" id="p1-sub">Ready</div>
            </div>
            <span class="pill" id="p1-status">Your turn</span>
          </div>

          <!-- Player 2 -->
          <div class="player-card" id="player2-card" style="margin-top: 10px">
            <div class="avatar" id="p2-avatar">P2</div>
            <div>
              <div class="p-name" id="p2-name">Player Two</div>
              <div class="p-sub" id="p2-sub">Connected</div>
            </div>
            <span class="pill" id="p2-status">Waiting</span>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">Status</div>
          <div class="status-tile">
            <div id="interval-display">Interval: (none selected)</div>
            <div id="current-player-display">Current Player: —</div>
          </div>
        </div>
      </aside>

      <!-- MAIN: canvas area -->
      <main class="main">
        <div class="surface">
          <canvas id="canvas" width="1200" height="1200"></canvas>
        </div>
      </main>

      <!-- RIGHT: chat -->
      <aside class="right">
        <div class="panel chat" id="chat-panel">
          <div class="panel-title">Chat</div>

          <div class="chat-log" id="chatMessages" aria-live="polite">
            <!-- Example placeholders -->
            <div class="msg">
              <span class="muted">System:</span> Welcome to Countercraft.
            </div>
          </div>

          <form class="chat-input" id="chatForm" autocomplete="off">
            <input
              class="input"
              id="chatInput"
              name="message"
              placeholder="Type a message…"
            />
            <button class="btn btn-primary" id="chatSend" type="submit">
              Send
            </button>
          </form>
        </div>
      </aside>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="./main.js"></script>

    <script>
      // Fullscreen toggle for the play surface
      document
        .getElementById("btnFullscreen")
        ?.addEventListener("click", () => {
          const surface = document.querySelector(".surface");
          if (!document.fullscreenElement) {
            surface.requestFullscreen?.();
          } else {
            document.exitFullscreen?.();
          }
        });

      // Minimal chat plumbing hooks — wire to your Socket.IO in main.js
      const chatForm = document.getElementById("chatForm");
      const chatInput = document.getElementById("chatInput");
      const chatMessages = document.getElementById("chatMessages");

      chatForm?.addEventListener("submit", (e) => {
        e.preventDefault();
        const text = chatInput.value.trim();
        if (!text) return;
        // TODO: emit to socket here
        appendMsg("You", text, true);
        chatInput.value = "";
      });

      function appendMsg(author, text, isMe = false) {
        const el = document.createElement("div");
        el.className = "msg" + (isMe ? " me" : "");
        el.innerHTML = `<strong>${author}:</strong> ${escapeHtml(text)}`;
        chatMessages.appendChild(el);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
      function escapeHtml(str) {
        return str.replace(
          /[&<>"']/g,
          (s) =>
            ({
              "&": "&amp;",
              "<": "&lt;",
              ">": "&gt;",
              '"': "&quot;",
              "'": "&#39;",
            }[s])
        );
      }

      // Example: update status from your game logic (keep ids the same)
      // document.getElementById('interval-display').textContent = 'Interval: Perfect Fifth';
      // document.getElementById('current-player-display').textContent = 'Current Player: Danny';
    </script>
  </body>
</html>
